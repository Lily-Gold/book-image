<div data-controller="mobile-menu">

  <header
    class="bg-[#004865] text-white h-14 fixed top-0 left-0 w-full z-50 shadow-md"
  >
    <div class="flex justify-between items-center h-full px-6 md:px-10">

      <!-- â–¼ ãƒ­ã‚´ -->
      <h1 class="text-2xl font-bold font-['EB_Garamond'] tracking-wide flex items-center">
        <%= link_to root_path, class: "flex items-center gap-1 hover:opacity-80 transition-opacity duration-200 cursor-pointer" do %>
          Book Image
          <%= image_tag "logo.png",
                alt: "Book Image ã‚¢ã‚¤ã‚³ãƒ³",
                class: "h-10 w-auto object-contain translate-y-[1px]" %>
        <% end %>
      </h1>

      <!-- ===================================== -->
      <!-- â–¼ PCç”¨ï¼ˆmdä»¥ä¸Šã§è¡¨ç¤ºï¼‰ -->
      <!-- ===================================== -->
      <div class="hidden md:flex items-center gap-6">

        <%= render "layouts/search_form" %>

        <nav class="relative flex items-center gap-6 text-sm -mr-0.5">
          <% if user_signed_in? %>

            <%= render "shared/notification_bell" %>

            <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå…ƒã‚³ãƒ¼ãƒ‰å®Œå…¨ç¶­æŒï¼‰ -->
            <div data-controller="dropdown" class="relative flex items-center justify-end w-[5rem]">
              <div
                data-action="mouseenter->dropdown#show mouseleave->dropdown#hide click->dropdown#toggle"
                class="relative"
              >
                <div
                  class="transition duration-200 cursor-pointer"
                  style="width: 2.8rem; height: 2.8rem; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center;"
                >
                  <%= image_tag(
                    display_image_url(
                      current_user,
                      size: :avatar_header,
                      image_attribute: :avatar
                    ) || asset_path('avatar.png'),
                    alt: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ',
                    class: [
                     'rounded-full cursor-pointer object-cover',
                      (current_user.avatar.attached? ? 'w-11 h-11 border border-gray-400/60' : 'w-21.5 h-21.5')
                    ].compact.join(' ')
                  ) %>
                </div>

                <div
                  data-dropdown-target="menu"
                  class="absolute left-[-5rem] top-[1.8rem] w-40 bg-white text-gray-700 rounded-md shadow-lg border border-gray-200 hidden text-center transition transform opacity-0 scale-95 z-50"
                >
                  <%= link_to edit_user_registration_path,
                      class: "block px-4 py-2 cursor-pointer transition-colors duration-200 hover:text-[#986321] hover:underline hover:decoration-[#986321] hover:decoration-2 hover:underline-offset-2" do %>
                    ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š
                  <% end %>

                  <%= button_to 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ',
                        destroy_user_session_path,
                        method: :delete,
                        class: 'w-full text-center px-4 py-2 cursor-pointer transition-colors duration-200 hover:text-[#986321] hover:underline hover:decoration-[#986321] hover:decoration-2 hover:underline-offset-2' %>
                </div>
              </div>
            </div>

          <% else %>
            <%= link_to 'ãƒ­ã‚°ã‚¤ãƒ³',
                  new_user_session_path,
                  class: 'hover:underline cursor-pointer' %>

            <%= link_to 'æ–°è¦ç™»éŒ²',
                  new_user_registration_path,
                  class: 'bg-[#986321] text-white px-4 py-2 rounded-md hover:opacity-90 transition-opacity duration-200 no-underline text-sm cursor-pointer' %>
          <% end %>
        </nav>
      </div>

      <!-- ===================================== -->
      <!-- â–¼ ã‚¹ãƒžãƒ›ç”¨ï¼ˆmdæœªæº€ã§è¡¨ç¤ºï¼‰ -->
      <!-- ===================================== -->
      <div class="flex items-center gap-4 md:hidden">

        <!-- ðŸ” -->
        <button data-action="click->mobile-search#toggle">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z"/>
          </svg>
        </button>

        <!-- ðŸ””ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿ï¼‰ -->
        <% if user_signed_in? %>
          <%= render "shared/notification_bell" %>
        <% end %>

        <!-- â˜° -->
        <button data-action="click->mobile-menu#toggle">
          <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>

      </div>

    </div>
  </header>

  <!-- â–¼ ã‚¹ãƒžãƒ›ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼æœ¬ä½“ -->
  <div
    data-mobile-menu-target="panel"
    class="fixed top-14 right-0 w-64 h-full bg-white text-gray-800 shadow-lg
            transform translate-x-full transition-transform duration-300
            md:hidden z-40"
  >
    <nav class="flex flex-col p-6 text-base">

      <!-- ===== ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç³» ===== -->
      <%= link_to "ãƒˆãƒƒãƒ—", root_path,
            class: "py-2 hover:text-[#986321] transition" %>

      <%= link_to "æŠ•ç¨¿ä¸€è¦§", reviews_path,
            class: "py-2 hover:text-[#986321] transition" %>

      <% if user_signed_in? %>

        <%= link_to "æ–°è¦æŠ•ç¨¿", new_review_path,
              class: "py-2 hover:text-[#986321] transition" %>

        <%= link_to "ãƒžã‚¤ãƒšãƒ¼ã‚¸", profile_path,
              class: "py-2 hover:text-[#986321] transition" %>

        <!-- åŒºåˆ‡ã‚Šç·š -->
        <div class="border-t border-gray-200 my-4"></div>

        <!-- ===== ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç³» ===== -->
        <%= link_to "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š", edit_user_registration_path,
              class: "py-2 hover:text-[#986321] transition" %>

        <%= button_to "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ",
              destroy_user_session_path,
              method: :delete,
              class: "text-left py-2 hover:text-[#986321] transition" %>

      <% else %>

        <!-- åŒºåˆ‡ã‚Šç·š -->
        <div class="border-t border-gray-200 my-4"></div>

        <%= link_to "ãƒ­ã‚°ã‚¤ãƒ³", new_user_session_path,
              class: "py-2 hover:text-[#986321] transition" %>

        <%= link_to "æ–°è¦ç™»éŒ²", new_user_registration_path,
              class: "py-2 hover:text-[#986321] transition" %>

     <% end %>

    </nav>
  </div>

  <!-- â–¼ èƒŒæ™¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆheaderã®å¤–ï¼‰ -->
  <div
    data-mobile-menu-target="overlay"
    data-action="click->mobile-menu#close"
    class="fixed inset-0 bg-black/30
           opacity-0 pointer-events-none
           transition-opacity duration-300
           md:hidden z-30">
  </div>
</div>
