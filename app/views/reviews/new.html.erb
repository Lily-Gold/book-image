<div class="flex justify-center items-center min-h-[87vh] bg-[#F4F4F4]">
  <div class="w-full max-w-3xl my-[1.5rem] pb-[1.5rem]">

    <!-- ページタイトル -->
    <h2 class="text-3xl font-bold text-center text-[#004865] mb-8">
      レビューの投稿
    </h2>

    <!-- 白カード -->
    <div class="bg-white pt-8 pb-10 px-10 rounded-xl shadow-lg space-y-8">

      <%= form_with(model: @review, local: true, html: { class: "space-y-8" }) do |f| %>

        <%# -------------------- 上段：レビューの中心 -------------------- %>
        <div class="space-y-4 border-b border-gray-300 pb-8">
          <h3 class="text-xl font-semibold text-[#004865] mb-2">投稿する内容</h3>

          <%# === 本の基本情報 === %>
          <%= f.fields_for :book do |b| %>
            <%# タイトル %>
            <div>
              <%= b.label :title, "本のタイトル", class: "block text-sm font-medium text-gray-700 mb-1" %>
              <%= b.text_field :title, required: true, placeholder: "例：こころ",
                class: "w-full border border-gray-300 rounded-lg p-2 text-base focus:outline-none focus:ring-2 focus:ring-[#004865]" %>
            </div>

            <%# 著者名 %>
            <div>
              <%= b.label :author, "著者名", class: "block text-sm font-medium text-gray-700 mb-1" %>
              <%= b.text_field :author, placeholder: "例：夏目漱石",
                class: "w-full border border-gray-300 rounded-lg p-2 text-base focus:outline-none focus:ring-2 focus:ring-[#004865]" %>
            </div>
          <% end %>

          <%# === 印象カラー === %>
          <div data-controller="color-tag" class="space-y-2">
            <%= f.label :image_tag_id, "印象カラー", class: "block text-sm font-medium text-gray-700" %>
            <p class="text-xs text-gray-500">
              この本から受けた印象に最も合うタグを1つ選んでください。選んだタグに応じて、投稿カラーが自動で変化します。
            </p>

            <div class="flex items-center gap-3">
              <span data-color-tag-target="preview" class="w-5 h-5 rounded-full border border-gray-300 shadow-sm"></span>

              <select
                data-color-tag-target="select"
                data-action="change->color-tag#updatePreview"
                name="review[image_tag_id]"
                id="review_image_tag_id"
                class="flex-1 border border-gray-300 rounded-lg p-2 text-base focus:outline-none focus:ring-2 focus:ring-[#004865]"
              >
                <option value="">印象カラーを選択</option>
                <% ImageTag.all.each do |tag| %>
                  <option value="<%= tag.id %>" data-color="<%= tag.color %>">
                    <%= tag.name %>
                  </option>
                <% end %>
              </select>
            </div>
          </div>

          <%# === レビュー本文・ネタバレ === %>
          <div>
            <div class="flex items-center gap-3 mb-1">
              <%= f.label :content, "レビュー本文", class: "block text-sm font-medium text-gray-700" %>

              <div class="flex items-center gap-1">
                <%= f.check_box :is_spoiler, class: "accent-[#004865] w-4 h-4" %>
                <%= f.label :is_spoiler, "ネタバレを含む", class: "text-sm text-gray-700 select-none" %>
              </div>
            </div>

            <%= f.text_area :content, rows: 6,
              placeholder: "読んだ感想や印象を書いてください",
              class: "w-full border border-gray-300 rounded-lg p-3 text-base focus:outline-none focus:ring-2 focus:ring-[#004865]" %>
          </div>

          <%# === 書影（画像プレビュー付き） === %>
          <%= f.fields_for :book do |b| %>
            <div data-controller="cover-preview" class="space-y-2">
              <%= b.label :cover, "書影（画像ファイル）", class: "block text-sm font-medium text-gray-700 mb-1" %>

              <%= b.file_field :cover,
                direct_upload: true,
                data: {
                  action: "change->cover-preview#show",
                  "cover-preview-target": "input"
                },
                class: "w-full border border-gray-300 rounded-lg p-2 text-base cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#004865]" %>

              <!-- プレビュー表示 -->
              <img
                data-cover-preview-target="preview"
                class="hidden mt-3 max-h-52 rounded shadow-sm"
              >

              <p class="text-xs text-gray-500">対応形式：jpg / jpeg / png（5MBまで）</p>
            </div>
          <% end %>
        </div>

        <%# -------------------- 本の詳細（任意） -------------------- %>
        <div class="space-y-4">
          <h3 class="text-xl font-semibold text-[#004865] mb-2">本の詳細（任意）</h3>

          <%= f.fields_for :book do |b| %>
            <%# 出版社 %>
            <div>
              <%= b.label :publisher, "出版社", class: "block text-sm font-medium text-gray-700 mb-1" %>
              <%= b.text_field :publisher, placeholder: "例：岩波文庫",
                class: "w-full border border-gray-300 rounded-lg p-2 text-base focus:outline-none focus:ring-2 focus:ring-[#004865]" %>
            </div>

            <%# 発行日 %>
            <div>
              <%= b.label :published_on, "発行日", class: "block text-sm font-medium text-gray-700 mb-1" %>
              <%= b.date_field :published_on,
                class: "w-full border border-gray-300 rounded-lg p-2 text-base focus:outline-none focus:ring-2 focus:ring-[#004865]" %>
            </div>

            <%# ISBN %>
            <div>
              <%= b.label :isbn, "ISBNコード", class: "block text-sm font-medium text-gray-700 mb-1" %>
              <%= b.text_field :isbn, placeholder: "例：9784003101018",
                class: "w-full border border-gray-300 rounded-lg p-2 text-base focus:outline-none focus:ring-2 focus:ring-[#004865]" %>
            </div>

            <%# あらすじ %>
            <div>
              <%= b.label :description, "あらすじ", class: "block text-sm font-medium text-gray-700 mb-1" %>
              <%= b.text_area :description, rows: 3,
                class: "w-full border border-gray-300 rounded-lg p-3 text-base focus:outline-none focus:ring-2 focus:ring-[#004865]" %>
            </div>
          <% end %>
        </div>

        <%# -------------------- 投稿ボタン -------------------- %>
        <div class="actions mt-10">
          <%= f.submit "投稿する",
            class: "w-full bg-[#986321] text-white text-lg py-3 rounded-lg hover:opacity-90 transition" %>
        </div>

      <% end %>
    </div>
  </div>
</div>
